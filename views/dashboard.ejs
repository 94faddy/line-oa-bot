<%- include('partials/header', {
    title: 'Dashboard',
    pageIcon: 'üìä',
    pageTitle: 'Dashboard',
    pageSubtitle: '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö LINE OA Bot',
    username: username,
    activePage: 'dashboard'
}) %>

<!-- Stats Section -->
<div class="stats">
    <div class="stat-card">
        <div class="icon">üë•</div>
        <h3>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <div class="value"><%= totalUsers %></div>
    </div>

    <div class="stat-card">
        <div class="icon">üì±</div>
        <h3>LINE Channels</h3>
        <div class="value"><%= activeChannels %>/<%= totalChannels %></div>
        <small style="color: #666;">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô/‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small>
    </div>

    <div class="stat-card">
        <div class="icon">üéÅ</div>
        <h3>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ä‡∏£‡πå</h3>
        <div class="value"><%= activityKeywords %></div>
        <small style="color: #666;">‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î</small>
    </div>

    <div class="stat-card">
        <div class="icon">üé®</div>
        <h3>‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h3>
        <div class="value"><%= totalPromotions %></div>
        <small style="color: #666;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</small>
    </div>
</div>

<!-- Quick Actions Section -->
<div class="section">
    <h2>üöÄ ‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πà‡∏ß‡∏ô</h2>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
        <a href="/activities" style="text-decoration: none;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; transition: transform 0.3s; cursor: pointer;">
                <div style="font-size: 3em; margin-bottom: 10px;">üéÅ</div>
                <h3 style="margin-bottom: 10px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ä‡∏£‡πå</h3>
                <p style="opacity: 0.9; font-size: 0.9em;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î</p>
            </div>
        </a>

        <a href="/promotions" style="text-decoration: none;">
            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; transition: transform 0.3s; cursor: pointer;">
                <div style="font-size: 3em; margin-bottom: 10px;">üé®</div>
                <h3 style="margin-bottom: 10px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h3>
                <p style="opacity: 0.9; font-size: 0.9em;">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Flex Messages</p>
            </div>
        </a>

        <a href="/settings" style="text-decoration: none;">
            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; transition: transform 0.3s; cursor: pointer;">
                <div style="font-size: 3em; margin-bottom: 10px;">‚öôÔ∏è</div>
                <h3 style="margin-bottom: 10px;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <p style="opacity: 0.9; font-size: 0.9em;">LINE API ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ</p>
            </div>
        </a>

        <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 30px; border-radius: 15px; text-align: center;">
            <div style="font-size: 3em; margin-bottom: 10px;">üìä</div>
            <h3 style="margin-bottom: 10px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <p style="opacity: 0.9; font-size: 0.9em;">
                LINE Bot: <%= lineConfigured ? '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß' : '‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠' %>
            </p>
        </div>
    </div>
</div>

<!-- System Info Section -->
<div class="section">
    <h2>‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>
    
    <div class="info-box">
        <strong>ü§ñ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ LINE Bot:</strong> 
        <%= lineConfigured ? '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (' + activeChannels + ' channel(s))' : '‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö"' %>
    </div>

    <div class="info-box" style="margin-top: 10px;">
        <strong>üì° Webhook URL:</strong> 
        <code><%= webhookUrl %></code>
    </div>

    <div class="info-box" style="margin-top: 10px;">
        <strong>üîë ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</strong> 
        <%= activityKeywordsList %>
    </div>

    <div class="info-box" style="margin-top: 10px;">
        <strong>üé® ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô:</strong> 
        <%= promotionKeywordsList %>
    </div>
</div>

<!-- Recent Activity Section -->
<div class="section">
    <h2>üìã ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
    
    <% if (recentUsers.length === 0) { %>
        <div class="empty-state">
            <div class="icon">üì≠</div>
            <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
            <p>‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</p>
        </div>
    <% } else { %>
        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
            <thead style="background: #667eea; color: white;">
                <tr>
                    <th style="padding: 15px; text-align: left;">#</th>
                    <th style="padding: 15px; text-align: left;">User ID</th>
                    <th style="padding: 15px; text-align: left;">‡πÄ‡∏ß‡∏•‡∏≤</th>
                    <th style="padding: 15px; text-align: left;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                </tr>
            </thead>
            <tbody>
                <% recentUsers.forEach((user, index) => { %>
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 15px;"><%= index + 1 %></td>
                        <td style="padding: 15px;"><%= user.userId.substring(0, 20) %>...</td>
                        <td style="padding: 15px;"><%= user.lastSent %></td>
                        <td style="padding: 15px;">
                            <span style="padding: 5px 12px; border-radius: 15px; font-size: 0.85em; font-weight: bold; background: <%= user.canSend ? '#d4edda' : '#fff3cd' %>; color: <%= user.canSend ? '#155724' : '#856404' %>;">
                                <%= user.canSend ? '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á' : '‚è≥ ‡∏£‡∏≠' %>
                            </span>
                        </td>
                    </tr>
                <% }); %>
            </tbody>
        </table>

        <% if (recentUsers.length >= 5) { %>
            <div style="text-align: center; margin-top: 20px;">
                <a href="/activities" class="btn btn-primary">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí</a>
            </div>
        <% } %>
    <% } %>
</div>

<script>
    // Refresh every 60 seconds
    setTimeout(() => {
        location.reload();
    }, 60000);
</script>

<%- include('partials/footer') %>